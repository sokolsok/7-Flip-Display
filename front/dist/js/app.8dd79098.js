(function(){"use strict";var e={9921:function(e,a,o){var t=o(5130),n=o(6768);const l={class:"app"};function r(e,a,o,t,r,u){const i=(0,n.g2)("UpdateCheck"),s=(0,n.g2)("WifiConfig"),v=(0,n.g2)("MqttData");return(0,n.uX)(),(0,n.CE)("div",l,[(0,n.bF)(i),(0,n.bF)(s),(0,n.bF)(v)])}var u=o(4232),i=o(144);const s={class:"update-check"},v={class:"label"},c={key:0,style:{color:"green"}},p={key:1,style:{color:"red"}},d={key:2,style:{color:"green"}},f={key:3,style:{color:"red"}},b={key:0},w={key:1,class:"progress-container"},m={class:"label"},k={class:"progress-wrapper"},h=["value"],y={class:"progress-percent"};var g={__name:"UpdateCheck",setup(e){const a=(0,i.KR)(""),o=(0,i.KR)(""),t=(0,i.KR)(""),l=(0,i.KR)(""),r=(0,i.KR)(!1),g=(0,i.KR)(""),L=(0,i.KR)(""),_=(0,i.KR)(""),C=(0,i.KR)(0),A=(0,i.KR)(!1),E=(0,i.KR)(""),O=(0,i.KR)(!1);async function T(){try{const e=await fetch("/api/v1/versions"),t=await e.json();a.value=t.versions.firm_version,o.value=t.versions.web_app_version}catch(e){E.value="Error fetching installed versions",console.error("Error fetching installed versions:",e)}}async function K(){try{const e=await fetch("https://download.smartsolutions4home.com/ota-firmware/7-flip-firmware/version.json"),a=await e.json();t.value=a.firmware_version,l.value=a.web_app_version}catch(e){return g.value="offline",void(L.value="offline")}g.value=a.value!==t.value?"update":"",L.value=o.value!==l.value?"update":"",r.value="update"===g.value||"update"===L.value}function R(){a.value===t.value&&o.value===l.value||"offline"===g.value||"offline"===L.value?r.value=!1:r.value=!0}let S=null;function j(){S=setInterval((async()=>{try{const e=await fetch("/api/v1/ota/progress"),a=await e.json();C.value=a.progress,C.value>0&&!O.value&&(O.value=!0),O.value&&0===C.value&&(clearInterval(S),O.value=!1,window.location.reload())}catch(e){console.error("Error polling OTA progress:",e)}}),1e3)}async function V(){A.value=!0,C.value=0;const e=a.value!==t.value,n=o.value!==l.value;if(e&&n){_.value="Updating Web-App and Firmware...";try{const e=await fetch("/api/v1/ota/both",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({firmware_url:`https://download.smartsolutions4home.com/ota-firmware/7-flip-firmware/firmware_v${t.value}.bin`,web_app_url:`https://download.smartsolutions4home.com/ota-firmware/7-flip-firmware/web_app_v${l.value}.bin`})}),a=await e.text();E.value=a,j()}catch(r){E.value="Error starting combined OTA update",console.error("Combined OTA error:",r)}}else if(e){_.value="Updating firmware...";try{const e=await fetch("/api/v1/ota/firmware",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({url:`https://download.smartsolutions4home.com/ota-firmware/7-flip-firmware/firmware_v${t.value}.bin`})}),a=await e.text();E.value=a,j()}catch(r){E.value="Error starting firmware OTA update",console.error("Firmware OTA error:",r)}}else if(n){_.value="Updating Web-App...";try{const e=await fetch("/api/v1/ota/web_app",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({url:`https://download.smartsolutions4home.com/ota-firmware/7-flip-firmware/web_app_v${l.value}.bin`})}),a=await e.text();E.value=a,j()}catch(r){E.value="Error starting Web-App OTA update",console.error("Web-App OTA error:",r)}}}return(0,n.sV)((async()=>{await T(),await K(),R()})),(e,i)=>((0,n.uX)(),(0,n.CE)("div",s,[i[0]||(i[0]=(0,n.Lk)("h3",null,"Versions",-1)),(0,n.Lk)("div",v,[(0,n.Lk)("p",null,[(0,n.eW)(" Firmware: "+(0,u.v_)(a.value)+" ",1),"update"===g.value?((0,n.uX)(),(0,n.CE)("span",c,"("+(0,u.v_)(t.value)+")",1)):"offline"===g.value?((0,n.uX)(),(0,n.CE)("span",p,"(N/A)")):(0,n.Q3)("",!0),(0,n.eW)(" | Web App: "+(0,u.v_)(o.value)+" ",1),"update"===L.value?((0,n.uX)(),(0,n.CE)("span",d,"("+(0,u.v_)(l.value)+")",1)):"offline"===L.value?((0,n.uX)(),(0,n.CE)("span",f,"(N/A)")):(0,n.Q3)("",!0)])]),A.value?(0,n.Q3)("",!0):((0,n.uX)(),(0,n.CE)("div",b,[r.value?((0,n.uX)(),(0,n.CE)("button",{key:0,onClick:V},"UPDATE AVAILABLE")):(0,n.Q3)("",!0)])),A.value?((0,n.uX)(),(0,n.CE)("div",w,[(0,n.Lk)("div",m,(0,u.v_)(_.value),1),(0,n.Lk)("div",k,[(0,n.Lk)("progress",{max:"100",value:C.value},null,8,h),(0,n.Lk)("div",y,(0,u.v_)(C.value)+"%",1)])])):(0,n.Q3)("",!0)]))}},L=o(1241);const _=(0,L.A)(g,[["__scopeId","data-v-3fee4cee"]]);var C=_;const A={class:"wifi-config"},E={class:"wifi-mode"},O={key:0};var T={__name:"WifiConfig",setup(e){const a=(0,i.KR)(""),o=(0,i.KR)("AP"),l=(0,i.KR)(""),r=(0,i.KR)("");async function s(){try{const e=await fetch("/api/v1/mode");if(e.ok){const t=await e.json();a.value=t.mode,o.value=t.mode,l.value=t.ssid||"",r.value=""}else console.error("Failed to fetch configuration")}catch(e){console.error("Error fetching configuration:",e)}}async function v(){const e={mode:o.value};"STA"===o.value&&(e.ssid=l.value,e.password=r.value);try{const a=await fetch("/api/v1/mode",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(a.ok){const e=await a.text();alert(e)}else alert("Failed to update configuration")}catch(a){console.error("Error updating configuration:",a),alert("Error updating configuration")}}return(0,n.sV)((()=>{s()})),(e,i)=>((0,n.uX)(),(0,n.CE)("div",A,[i[10]||(i[10]=(0,n.Lk)("h3",null,"Wi-Fi Configuration",-1)),(0,n.Lk)("div",null,[(0,n.Lk)("label",null,"Current Mode: "+(0,u.v_)(a.value),1)]),(0,n.Lk)("div",E,[(0,n.bo)((0,n.Lk)("input",{type:"radio",id:"ap",value:"AP","onUpdate:modelValue":i[0]||(i[0]=e=>o.value=e)},null,512),[[t.XL,o.value]]),i[4]||(i[4]=(0,n.Lk)("label",{for:"ap"},"Access Point",-1)),i[5]||(i[5]=(0,n.Lk)("br",null,null,-1)),(0,n.bo)((0,n.Lk)("input",{type:"radio",id:"sta",value:"STA","onUpdate:modelValue":i[1]||(i[1]=e=>o.value=e)},null,512),[[t.XL,o.value]]),i[6]||(i[6]=(0,n.Lk)("label",{for:"sta"},"Wi-Fi Client",-1))]),"STA"===o.value?((0,n.uX)(),(0,n.CE)("div",O,[(0,n.Lk)("div",null,[i[7]||(i[7]=(0,n.Lk)("br",null,null,-1)),i[8]||(i[8]=(0,n.Lk)("label",{for:"ssid"},"SSID:",-1)),(0,n.bo)((0,n.Lk)("input",{type:"text",id:"ssid","onUpdate:modelValue":i[2]||(i[2]=e=>l.value=e)},null,512),[[t.Jo,l.value]])]),(0,n.Lk)("div",null,[i[9]||(i[9]=(0,n.Lk)("label",{for:"password"},"Password:",-1)),(0,n.bo)((0,n.Lk)("input",{type:"password",id:"password","onUpdate:modelValue":i[3]||(i[3]=e=>r.value=e)},null,512),[[t.Jo,r.value]])])])):(0,n.Q3)("",!0),(0,n.Lk)("button",{onClick:v},"SAVE")]))}};const K=(0,L.A)(T,[["__scopeId","data-v-13b671e4"]]);var R=K;const S=[".class"],j={key:1,type:"submit"};var V={__name:"MqttData",setup(e){const a=(0,i.KR)({enabled:!1,broker:"",port:"",login:"",password:""}),o=(0,i.KR)(!1),l=(0,i.KR)("SAVE"),r=(0,i.KR)(""),s=async()=>{try{const e=await fetch("/api/v1/mqtt");if(!e.ok)throw new Error("Failed to fetch configuration");const o=await e.json();a.value.enabled=o.enabled,a.value.broker=o.broker,a.value.port=o.port,a.value.login=o.login,a.value.password=o.password}catch(e){r.value=e.message}},v=()=>{o.value=!0},c=async()=>{try{const e={enabled:a.value.enabled,host:a.value.broker,port:a.value.port,login:a.value.login,password:a.value.password},o=await fetch("/api/v1/mqtt",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!o.ok){const e=await o.text();throw new Error(e||"Failed to save configuration")}r.value="Configuration saved successfully",l.value="SAVED"}catch(e){r.value=e.message}};return(0,n.sV)((()=>{s()})),(e,r)=>((0,n.uX)(),(0,n.CE)("form",{onSubmit:(0,t.D$)(c,["prevent"])},[r[11]||(r[11]=(0,n.Lk)("h3",null,"MQTT Configuration",-1)),(0,n.Lk)("div",null,[(0,n.bo)((0,n.Lk)("input",{type:"checkbox",onInput:v,id:"enabled","onUpdate:modelValue":r[0]||(r[0]=e=>a.value.enabled=e)},null,544),[[t.lH,a.value.enabled]]),r[5]||(r[5]=(0,n.Lk)("label",{for:"enabled"},"Enable MQTT",-1))]),!0===a.value.enabled?((0,n.uX)(),(0,n.CE)("div",{key:0,".class":e.settings},[(0,n.Lk)("div",null,[r[6]||(r[6]=(0,n.Lk)("br",null,null,-1)),r[7]||(r[7]=(0,n.Lk)("label",null,"Broker Address:",-1)),(0,n.bo)((0,n.Lk)("input",{type:"text",onInput:v,id:"broker","onUpdate:modelValue":r[1]||(r[1]=e=>a.value.broker=e)},null,544),[[t.Jo,a.value.broker]])]),(0,n.Lk)("div",null,[r[8]||(r[8]=(0,n.Lk)("label",null,"Port number:",-1)),(0,n.bo)((0,n.Lk)("input",{type:"number",onInput:v,id:"port","onUpdate:modelValue":r[2]||(r[2]=e=>a.value.port=e)},null,544),[[t.Jo,a.value.port,void 0,{number:!0}]])]),(0,n.Lk)("div",null,[r[9]||(r[9]=(0,n.Lk)("label",null,"Login:",-1)),(0,n.bo)((0,n.Lk)("input",{type:"text",onInput:v,id:"login","onUpdate:modelValue":r[3]||(r[3]=e=>a.value.login=e)},null,544),[[t.Jo,a.value.login]])]),(0,n.Lk)("div",null,[r[10]||(r[10]=(0,n.Lk)("label",null,"PAssword:",-1)),(0,n.bo)((0,n.Lk)("input",{type:"password",onInput:v,id:"password","onUpdate:modelValue":r[4]||(r[4]=e=>a.value.password=e)},null,544),[[t.Jo,a.value.password]])])],40,S)):(0,n.Q3)("",!0),!0===o.value?((0,n.uX)(),(0,n.CE)("button",j,(0,u.v_)(l.value),1)):(0,n.Q3)("",!0)],32))}};const U=(0,L.A)(V,[["__scopeId","data-v-7041edc5"]]);var X=U,x={name:"App",components:{UpdateCheck:C,WifiConfig:R,MqttData:X}};const P=(0,L.A)(x,[["render",r]]);var F=P;(0,t.Ef)(F).mount("#app")}},a={};function o(t){var n=a[t];if(void 0!==n)return n.exports;var l=a[t]={exports:{}};return e[t].call(l.exports,l,l.exports,o),l.exports}o.m=e,function(){var e=[];o.O=function(a,t,n,l){if(!t){var r=1/0;for(v=0;v<e.length;v++){t=e[v][0],n=e[v][1],l=e[v][2];for(var u=!0,i=0;i<t.length;i++)(!1&l||r>=l)&&Object.keys(o.O).every((function(e){return o.O[e](t[i])}))?t.splice(i--,1):(u=!1,l<r&&(r=l));if(u){e.splice(v--,1);var s=n();void 0!==s&&(a=s)}}return a}l=l||0;for(var v=e.length;v>0&&e[v-1][2]>l;v--)e[v]=e[v-1];e[v]=[t,n,l]}}(),function(){o.n=function(e){var a=e&&e.__esModule?function(){return e["default"]}:function(){return e};return o.d(a,{a:a}),a}}(),function(){o.d=function(e,a){for(var t in a)o.o(a,t)&&!o.o(e,t)&&Object.defineProperty(e,t,{enumerable:!0,get:a[t]})}}(),function(){o.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){o.o=function(e,a){return Object.prototype.hasOwnProperty.call(e,a)}}(),function(){var e={524:0};o.O.j=function(a){return 0===e[a]};var a=function(a,t){var n,l,r=t[0],u=t[1],i=t[2],s=0;if(r.some((function(a){return 0!==e[a]}))){for(n in u)o.o(u,n)&&(o.m[n]=u[n]);if(i)var v=i(o)}for(a&&a(t);s<r.length;s++)l=r[s],o.o(e,l)&&e[l]&&e[l][0](),e[l]=0;return o.O(v)},t=self["webpackChunk_7_flip_display"]=self["webpackChunk_7_flip_display"]||[];t.forEach(a.bind(null,0)),t.push=a.bind(null,t.push.bind(t))}();var t=o.O(void 0,[504],(function(){return o(9921)}));t=o.O(t)})();
//# sourceMappingURL=app.8dd79098.js.map